<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hipstersk√Ω byt ‚Äì n√°kupn√≠ seznam</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body.dark-mode {
      background-color: #121212;
      color: white;
    }

    .item-row {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 3px 6px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .dark-mode .item-row {
      background: #1e1e1e;
      color: #ccc;
    }

    .item-row.checked {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .bottom-toolbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #ddd;
      padding: 0.5rem;
      display: flex;
      justify-content: space-around;
      z-index: 999;
    }

    .dark-mode .bottom-toolbar {
      background: #1e1e1e;
      border-color: #333;
    }

    a.no-decoration {
      text-decoration: none;
      color: inherit;
    }

    a.no-decoration:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container py-4" id="app" style="display:none;">
    <h1 class="text-center mb-4" id="title">
      <a href="https://youtu.be/80RQvQpmcMs?si=DitrZG9wvCX6CF0T" target="_blank" class="no-decoration">
        üé∂ Hipstersk√Ω byt
      </a> ‚Äì n√°kupn√≠ seznam
    </h1>

    <div class="mb-3 d-flex gap-2">
      <input id="newItem" class="form-control" placeholder="P≈ôidat polo≈æku..." />
      <input id="newCount" type="number" class="form-control" style="max-width: 80px;" value="1" min="1" />
      <button class="btn btn-success" onclick="addItem()">‚ûï</button>
    </div>

    <div id="list"></div>
  </div>

  <div id="login" class="container py-5">
    <h2 class="text-center mb-4">P≈ôihl√°≈°en√≠</h2>
    <input id="username" class="form-control mb-2" placeholder="U≈æivatelsk√© jm√©no" />
    <input id="password" type="password" class="form-control mb-3" placeholder="Heslo" />
    <button class="btn btn-primary w-100" onclick="login()">P≈ôihl√°sit se</button>
  </div>

  <div class="bottom-toolbar">
    <button class="btn btn-success btn-sm" onclick="markAll()">‚úÖ Oznaƒçit v≈°e</button>
    <button class="btn btn-danger btn-sm" onclick="clearAll()">üßπ Smazat v≈°e</button>
    <button class="btn btn-outline-dark btn-sm" onclick="toggleDarkMode()">üåì</button>
    <button class="btn btn-outline-secondary btn-sm" onclick="logout()">üö™ Odhl√°sit se</button>
  </div>

  <script>
    const API_URL = "https://seznam.micm27.workers.dev/";
    const AUTH_TOKEN = "admin-token";

    let items = [];

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();

      if (user === "admin" && pass === "admin") {
        localStorage.setItem("auth", AUTH_TOKEN);
        document.getElementById("login").style.display = "none";
        document.getElementById("app").style.display = "block";
        loadData();
      } else {
        alert("Neplatn√© p≈ôihla≈°ovac√≠ √∫daje.");
        return;
      }
    }

    function logout() {
      localStorage.removeItem("auth");
      location.reload();
    }

    function loadData() {
      fetch(API_URL, {
        headers: { Authorization: `Bearer ${localStorage.getItem("auth")}` }
      })
        .then(res => res.json())
        .then(json => {
          items = json.record || [];
          renderList();
        })
        .catch(() => {
          items = [];
          renderList();
        });
    }

    function saveData() {
      fetch(API_URL, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${localStorage.getItem("auth")}`
        },
        body: JSON.stringify(items)
      });
    }

    function renderList() {
      const list = document.getElementById("list");
      list.innerHTML = "";

      if (items.length === 0) {
        list.innerHTML = "<p class='text-muted text-center'>Seznam je pr√°zdn√Ω.</p>";
        return;
      }

      items.forEach((item, i) => {
        const row = document.createElement("div");
        row.className = "item-row" + (item.checked ? " checked" : "");

        const left = document.createElement("div");
        left.className = "d-flex align-items-center gap-2";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = item.checked;
        checkbox.className = "form-check-input";
        checkbox.onchange = () => {
          items[i].checked = checkbox.checked;
          saveData();
          renderList();
        };

        const label = document.createElement("span");
        label.textContent = `${item.name} (${item.count} ks)`;

        left.appendChild(checkbox);
        left.appendChild(label);
        row.appendChild(left);
        list.appendChild(row);
      });
    }

    function addItem() {
      const name = document.getElementById("newItem").value.trim();
      const count = parseInt(document.getElementById("newCount").value.trim()) || 1;

      if (!name) return;

      items.push({ name, count, checked: false });
      document.getElementById("newItem").value = "";
      document.getElementById("newCount").value = "1";
      saveData();
      renderList();
    }

    document.getElementById("newItem").addEventListener("keydown", e => {
      if (e.key === "Enter") addItem();
    });

    function markAll() {
      items.forEach(i => i.checked = true);
      saveData();
      renderList();
    }

    function clearAll() {
      if (confirm("Opravdu smazat v≈°echny polo≈æky?")) {
        items = [];
        saveData();
        renderList();
      }
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    if (localStorage.getItem("auth") === AUTH_TOKEN) {
      document.getElementById("login").style.display = "none";
      document.getElementById("app").style.display = "block";
      loadData();
    }
  </script>
</body>
</html>
