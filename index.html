<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HipsterskÃ½ byt â€“ nÃ¡kupnÃ­ seznam</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #ece9e6, #ffffff);
      padding: 1.5rem;
    }
    .card-item {
      background: white;
      border-radius: 16px;
      padding: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-bottom: 1rem;
      transition: transform 0.2s;
    }
    .card-item:hover {
      transform: translateY(-3px);
    }
    .card-item.checked {
      background-color: #e0e0e0;
      text-decoration: line-through;
    }
    .count-input {
      width: 70px;
    }
    .toolbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #ddd;
      padding: 0.75rem 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      z-index: 1000;
    }
    .dark-mode body {
      background: #1e1e1e;
      color: #f4f4f4;
    }
    .dark-mode .card-item {
      background: #2c2c2c;
      color: #fff;
    }
    .dark-toggle {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>ğŸ¶ <a href="https://youtu.be/80RQvQpmcMs?si=DitrZG9wvCX6CF0T" target="_blank" class="text-decoration-none text-dark">HipsterskÃ½ byt</a> â€“ nÃ¡kupnÃ­ seznam</h2>
      <i class="fas fa-moon fa-lg dark-toggle" onclick="toggleDarkMode()"></i>
    </div>
    <div class="input-group mb-3">
      <input type="text" id="newItemInput" class="form-control" placeholder="PÅ™idat poloÅ¾ku..." onkeypress="handleKeyPress(event)">
      <button class="btn btn-primary" onclick="addItem()">â•</button>
    </div>
    <div id="shoppingList"></div>
  </div>

  <div class="toolbar">
    <button class="btn btn-success" onclick="markAllAsBought()">âœ… OznaÄit vÅ¡e jako koupenÃ©</button>
    <button class="btn btn-outline-danger" onclick="removeCheckedItems()">ğŸ—‘ï¸ Smazat koupenÃ©</button>
    <button class="btn btn-outline-dark" onclick="clearAllItems()">ğŸ§¹ Vymazat vÅ¡e</button>
    <button class="btn btn-outline-secondary" onclick="logout()">ğŸ”“ OdhlÃ¡sit se</button>
  </div>

  <script>
    const WORKER_URL = 'https://seznam.micm27.workers.dev/';
    const AUTH_HEADER = { 'Authorization': 'Bearer admin-token' };
    let data = [];

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        addItem();
      }
    }

    function renderList(items) {
      const container = document.getElementById('shoppingList');
      container.innerHTML = '';
      items.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'card-item' + (item.checked ? ' checked' : '');

        const row = document.createElement('div');
        row.className = 'd-flex justify-content-between align-items-center';

        const label = document.createElement('div');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'form-check-input me-2';
        checkbox.checked = item.checked;
        checkbox.onchange = () => {
          data[index].checked = checkbox.checked;
          updateBin(data);
        };
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(item.item));

        const countInput = document.createElement('input');
        countInput.type = 'number';
        countInput.min = 1;
        countInput.value = item.count || 1;
        countInput.className = 'form-control count-input';
        countInput.onchange = () => {
          data[index].count = parseInt(countInput.value, 10);
          updateBin(data);
        };

        row.appendChild(label);
        row.appendChild(countInput);
        card.appendChild(row);
        container.appendChild(card);
      });
    }

    function addItem() {
      const input = document.getElementById('newItemInput');
      const newItem = input.value.trim();
      if (newItem) {
        data.push({ item: newItem, count: 1, checked: false });
        input.value = '';
        updateBin(data);
      }
    }

    function removeCheckedItems() {
      if (!confirm('Smazat vÅ¡echny koupenÃ© poloÅ¾ky?')) return;
      data = data.filter(item => !item.checked);
      updateBin(data);
    }

    function clearAllItems() {
      if (!confirm('Opravdu chceÅ¡ vymazat celÃ½ seznam?')) return;
      data = [];
      updateBin(data);
    }

    function markAllAsBought() {
      data.forEach(item => item.checked = true);
      updateBin(data);
    }

    function logout() {
      localStorage.removeItem('authenticated');
      location.reload();
    }

    function updateBin(newData) {
      fetch(WORKER_URL, {
        method: 'PUT',
        headers: {
          ...AUTH_HEADER,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(newData)
      })
      .then(res => res.json())
      .then(() => renderList(newData))
      .catch(err => alert('Chyba uloÅ¾enÃ­: ' + err.message));
    }

    function loadData() {
      fetch(WORKER_URL, {
        method: 'GET',
        headers: AUTH_HEADER
      })
      .then(res => res.json())
      .then(json => {
        data = json.record.map(item => ({
          ...item,
          count: item.count || 1
        }));
        renderList(data);
      })
      .catch(err => alert('Chyba naÄtenÃ­: ' + err.message));
    }

    if (localStorage.getItem('authenticated') === 'true') {
      loadData();
    } else {
      const username = prompt('UÅ¾ivatelskÃ© jmÃ©no:');
      const password = prompt('Heslo:');
      if (username === 'admin' && password === 'admin') {
        localStorage.setItem('authenticated', 'true');
        loadData();
      } else {
        alert('NeplatnÃ© pÅ™ihlaÅ¡ovacÃ­ Ãºdaje');
      }
    }
  </script>
</body>
</html>
