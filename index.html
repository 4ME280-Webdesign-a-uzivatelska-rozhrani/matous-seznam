<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hipstersk√Ω byt ‚Äì n√°kupn√≠ seznam</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #ece9e6, #ffffff);
      padding: 1.5rem;
    }
    .card-item {
      background: white;
      border-radius: 16px;
      padding: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-bottom: 1rem;
      transition: transform 0.2s;
    }
    .card-item:hover {
      transform: translateY(-3px);
    }
    .card-item.checked {
      background-color: #e0e0e0;
      text-decoration: line-through;
    }
    .count-input {
      width: 70px;
    }
    .toolbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #ddd;
      padding: 0.75rem;
      display: flex;
      justify-content: space-between;
      z-index: 1000;
    }
    .dark-mode body {
      background: #1e1e1e;
      color: #f4f4f4;
    }
    .dark-mode .card-item {
      background: #2c2c2c;
      color: #fff;
    }
    .dark-toggle {
      cursor: pointer;
    }
    .category-title {
      font-weight: bold;
      margin-top: 2rem;
      border-bottom: 2px solid #ccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>üé∂ <a href="https://youtu.be/80RQvQpmcMs?si=DitrZG9wvCX6CF0T" target="_blank" class="text-decoration-none text-dark">Hipstersk√Ω byt</a> ‚Äì n√°kupn√≠ seznam</h2>
      <i class="fas fa-moon fa-lg dark-toggle" onclick="toggleDarkMode()"></i>
    </div>
    <div class="input-group mb-3">
      <input type="text" id="newItemInput" class="form-control" placeholder="P≈ôidat polo≈æku..." onkeypress="handleKeyPress(event)">
      <select id="categorySelect" class="form-select w-auto">
        <option value="J√≠dlo">J√≠dlo</option>
        <option value="Drogerie">Drogerie</option>
        <option value="Elektronika">Elektronika</option>
        <option value="Jin√©">Jin√©</option>
      </select>
      <button class="btn btn-primary" onclick="addItem()">‚ûï</button>
    </div>
    <div id="shoppingList"></div>
  </div>

  <div class="toolbar">
    <button class="btn btn-outline-danger" onclick="removeCheckedItems()">üóëÔ∏è Smazat koupen√©</button>
    <button class="btn btn-outline-secondary" onclick="logout()">üîì Odhl√°sit se</button>
  </div>

  <script>
    const WORKER_URL = 'https://seznam.micm27.workers.dev/';
    const AUTH_HEADER = { 'Authorization': 'Bearer admin-token' };
    let data = [];

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        addItem();
      }
    }

    function renderList(items) {
      const container = document.getElementById('shoppingList');
      container.innerHTML = '';

      const categories = {};
      items.forEach(item => {
        const cat = item.category || 'Jin√©';
        if (!categories[cat]) categories[cat] = [];
        categories[cat].push(item);
      });

      Object.keys(categories).forEach(cat => {
        const title = document.createElement('div');
        title.className = 'category-title';
        title.textContent = cat;
        container.appendChild(title);

        categories[cat].forEach((item, index) => {
          const card = document.createElement('div');
          card.className = 'card-item' + (item.checked ? ' checked' : '');

          const row = document.createElement('div');
          row.className = 'd-flex justify-content-between align-items-center';

          const label = document.createElement('div');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.className = 'form-check-input me-2';
          checkbox.checked = item.checked;
          checkbox.onchange = () => {
            item.checked = checkbox.checked;
            updateBin(data);
          };
          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(item.item));

          const countInput = document.createElement('input');
          countInput.type = 'number';
          countInput.min = 1;
          countInput.value = item.count || 1;
          countInput.className = 'form-control count-input';
          countInput.onchange = () => {
            item.count = parseInt(countInput.value, 10);
            updateBin(data);
          };

          row.appendChild(label);
          row.appendChild(countInput);
          card.appendChild(row);
          container.appendChild(card);
        });
      });
    }

    function addItem() {
      const input = document.getElementById('newItemInput');
      const category = document.getElementById('categorySelect').value;
      const newItem = input.value.trim();
      if (newItem) {
        data.push({ item: newItem, count: 1, checked: false, category });
        input.value = '';
        updateBin(data);
      }
    }

    function removeCheckedItems() {
      if (!confirm('Smazat v≈°echny koupen√© polo≈æky?')) return;
      data = data.filter(item => !item.checked);
      updateBin(data);
    }

    function logout() {
      localStorage.removeItem('authenticated');
      location.reload();
    }

    function updateBin(newData) {
      fetch(WORKER_URL, {
        method: 'PUT',
        headers: {
          ...AUTH_HEADER,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(newData)
      })
      .then(res => res.json())
      .then(() => renderList(newData))
      .catch(err => alert('Chyba ulo≈æen√≠: ' + err.message));
    }

    function loadData() {
      fetch(WORKER_URL, {
        method: 'GET',
        headers: AUTH_HEADER
      })
      .then(res => res.json())
      .then(json => {
        data = json.record.map(item => ({
          ...item,
          count: item.count || 1,
          category: item.category || 'Jin√©'
        }));
        renderList(data);
      })
      .catch(err => alert('Chyba naƒçten√≠: ' + err.message));
    }

    if (localStorage.getItem('authenticated') === 'true') {
      loadData();
    } else {
      const username = prompt('U≈æivatelsk√© jm√©no:');
      const password = prompt('Heslo:');
      if (username === 'admin' && password === 'admin') {
        localStorage.setItem('authenticated', 'true');
        loadData();
      } else {
        alert('Neplatn√© p≈ôihla≈°ovac√≠ √∫daje');
      }
    }
  </script>
</body>
</html>
